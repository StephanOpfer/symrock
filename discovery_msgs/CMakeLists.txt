cmake_minimum_required(VERSION 2.8.3)
project(discovery_msgs)

add_definitions(-std=c++11)

find_package(catkin REQUIRED)

catkin_package(
#  INCLUDE_DIRS include
#  LIBRARIES discovery_msgs
#  CATKIN_DEPENDS other_catkin_pkg
#  DEPENDS system_lib
)

include_directories(include)

## Autogenerate the c++ capnproto files

file(GLOB_RECURSE capnp_messages ${CMAKE_CURRENT_SOURCE_DIR}/capmsgs *.capnp)
message("${PROJECT_NAME}: Found the following *.capnp files: ${capnp_messages}")

add_custom_command(OUTPUT src/beacon.capnp.c++ include/${PROJECT_NAME}/beacon.capnp.h
  COMMAND capnp compile ${capnp_messages} -oc++:${CMAKE_CURRENT_SOURCE_DIR}/src
  DEPENDS ${capnp_messages}
  COMMENT "${PROJECT_NAME}: Generating *.c++ and *.h files from *.capnp files."
)

add_custom_target(${PROJECT_NAME}_generate_messages_cpp ALL
  COMMENT "${PROJECT_NAME}_generate_messages_cpp: Triggering generation."
  SOURCES src/beacon.capnp.c++ include/${PROJECT_NAME}/beacon.capnp.h
)

## Declare the C++ capnproto library

# TODO GLOB for capturing all autogenerated c++ files
#add_library(${PROJECT_NAME}
#  src/discovery_msgs.cpp
#)

# add_dependencies(${PROJECT_NAME} ${${PROJECT_NAME}_EXPORTED_TARGETS} ${catkin_EXPORTED_TARGETS})

# target_link_libraries(${PROJECT_NAME}_node
#   ${catkin_LIBRARIES}
# )
